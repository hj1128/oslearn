%MACRO INITREG 0
    MOV  AX,CS
    MOV  ES,AX
    MOV  SS,AX
    MOV  DS,AX
    MOV  FS,AX
%ENDMACRO
%MACRO INITREGP2R 0
    MOV  AX,SELECTORNORMAL
    MOV  ES,AX
    MOV  SS,AX
    MOV  DS,AX
    MOV  FS,AX
%ENDMACRO
%MACRO  INITDESC 2
      XOR  EAX,EAX
      MOV  AX,CS
      SHL  EAX,4
      ADD  EAX,%1
      MOV  WORD [%2 + 2],AX
      SHR  EAX,10H
      MOV  BYTE [%2 + 4],AL
      MOV  BYTE [%2 + 7],AH
%ENDMACRO

%MACRO  INITGDT 0
      XOR  EAX,EAX
      MOV  AX,CS
      SHL  EAX,4
      ADD  EAX,LABEL_GDT
      MOV  DWORD [GDTPTR + 2],EAX
%ENDMACRO


%MACRO OPENA20 0
    IN   AL,92H
    OR   AL,2
    OUT  92H,AL
%ENDMACRO
%MACRO CLOSEA20 0
    IN   AL,92H
    AND  AL,0FDH
    OUT  92H,AL
%ENDMACRO
%MACRO SETCR0PE 0
    MOV  EAX,CR0
    OR   EAX,1
    MOV  CR0,EAX
%ENDMACRO
%MACRO CANCELCR0PE 0
    MOV  EAX,CR0
    AND  EAX,0FEH
    MOV  CR0,EAX
%ENDMACRO
%MACRO CANCELCR0PE_PG 0
    MOV  EAX,CR0
    AND  EAX,7FFFFFFEH
    MOV  CR0,EAX
%ENDMACRO
%MACRO JMP2R3 0
    PUSH SELECTORSTACK3
    PUSH TOPOFSTACK3
    PUSH SELECTORCODE3
    PUSH 0
    RETF
%ENDMACRO
%MACRO SHOWCHAR 0
      PUSH EDI
      PUSH AX
      MOV  AX,0B800H
      MOV  GS,AX
      POP  AX
      MOV  AH,0CH
      MOV  EDI,[_POSITION]
      MOV  [GS:EDI],AX
      ADD  EDI,2
      MOV  [_POSITION],EDI
      POP  EDI
%ENDMACRO
%MACRO SHOWCHAR_P 0
      PUSH EDI
      PUSH AX
      MOV  AX,SELECTORVIDEO
      MOV  GS,AX
      MOV  AX,SELECTORDATA
      MOV  DS,AX
      POP  AX
      MOV  AH,0AH
      MOV  EDI,[POSITION]
      MOV  [GS:EDI],AX
      ADD  EDI,2
      MOV  [POSITION],EDI
      POP  EDI
%ENDMACRO
%MACRO SHOWRETURN 0
      MOV  EAX,[_POSITION]
      MOV  BL,160
      DIV  BL
      AND  EAX,0FFH
      INC  EAX
      MOV  BL,160
      MUL  BL
      MOV  [_POSITION],EAX
%ENDMACRO

%MACRO SHOWRETURN_P 0
      MOV  EAX,[POSITION]
      MOV  BL,160
      DIV  BL
      AND  EAX,0FFH
      INC  EAX
      MOV  BL,160
      MUL  BL
      MOV  [POSITION],EAX
%ENDMACRO