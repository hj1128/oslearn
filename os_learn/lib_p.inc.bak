SHOWSTR_P:
      MOV  AH,0AH
      MOV  EDI,[POSITION]
      CLD
      .STRLOOP:
        LODSB
        TEST AL,AL
        JZ   .STREND
        MOV  [GS:EDI],AX
        ADD  EDI,2
        JMP  .STRLOOP
      .STREND:
        MOV  [POSITION],EDI
      RET
SHOWAL_LOW_HEX_P:
      AND  AX,000FH
      CMP  AX,9
      JA   .ABOVE9
      ADD  AX,'0'
      JMP  .SHOWCHAR_HEX_P
      .ABOVE9:
        SUB  AX,0AH
        ADD  AX,'A'
      .SHOWCHAR_HEX_P:
        SHOWCHAR_P
      RET
SHOWAL_HEX_P:
      PUSH AX
      SHR  AX,4
      CALL SHOWAL_LOW_HEX_P
      POP  AX
      CALL SHOWAL_LOW_HEX_P
      RET     
SHOWAX_HEX_P:
      PUSH AX
      SHR  AX,8
      CALL SHOWAL_HEX_P
      POP  AX
      AND  AX,00FFH
      CALL SHOWAL_HEX_P
      RET
SHOWEAX_HEX_P:
      PUSH EAX
      PUSH EAX
      SHR  EAX,16
      CALL SHOWAX_HEX_P
      POP  EAX
      AND  EAX,0000FFFFH
      CALL SHOWAX_HEX_P
      MOV  AL,'H'
      SHOWCHAR_P
      MOV  AL,' '
      SHOWCHAR_P
      POP  EAX
      RET
DISPMEM_P:
      MOV  ECX,[MCRNUMBER]
      MOV  ESI,MEMCHKBUF
      CLD
      .DISPMEMLOOP:
        MOV  EDI,ARDSTRUCT
        MOV  EDX,5
        .ARDSTRUCTLOOP:
	  LODSD                 ;DS:ESI--->EAX,ESI自动增加
	  STOSD                 ;EAX--->ES:EDI,EDI自动增加
	  CALL SHOWEAX_HEX_P
	  DEC  EDX
	  TEST EDX,EDX
	  JZ  .ARDSTRUCTLOOPOK
	  JMP .ARDSTRUCTLOOP
	.ARDSTRUCTLOOPOK:
	  NOP
	  CMP DWORD [ARDSTRUCTTYPE],1
	  JNE .CHANGELINE
	  MOV EAX,[BASEADDRLOW]
	  ADD EAX,[LENGTHLOW]
	  CMP EAX,[MEMSIZE]
	  JB  .CHANGELINE
	  MOV [MEMSIZE],EAX
        .CHANGELINE:
          SHOWRETURN_P
	LOOP  .DISPMEMLOOP
        MOV  EAX,[MEMSIZE]
	CALL SHOWEAX_HEX_P
	SHOWRETURN_P
      RET

SETPAGE:
      MOV  AX,SELECTORPAGEDIR
      MOV  ES,AX
      MOV  ECX,1024
      XOR  EDI,EDI
      XOR  EAX,EAX
      MOV  EAX,PAGETBL|PG_P|PG_USU|PG_RWW
      .PAGEDIRLOOP:
        STOSD
	ADD EAX,4096
	LOOP .PAGEDIRLOOP

      MOV  AX,SELECTORPAGETBL
      MOV  ES,AX
      MOV  ECX,1024*1024
      XOR  EDI,EDI
      XOR  EAX,EAX
      MOV  EAX,PG_P|PG_USU|PG_RWW
      .PAGETBLOOP:
        STOSD
	ADD EAX,4096
	LOOP .PAGETBLOOP

      MOV  EAX,PAGEDIR
      MOV  CR3,EAX
      MOV  EAX,CR0
      OR   EAX,80000000H
      MOV  CR0,EAX
      NOP
      NOP
      RET